{% extends "base.html" %}

{% block title %}Payment - Tuition Portal{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="text-center mb-4">Complete Your Payment</h2>

  <section class="mb-4">
    <h4>Student Details</h4>
    <ul class="list-group">
      <li class="list-group-item"><strong>Name:</strong> {{ student.name }}</li>
      <li class="list-group-item"><strong>Email:</strong> {{ student.email[:2] ~ '***@***' }}</li>
      <li class="list-group-item"><strong>Mobile:</strong> {{ student.phone[:2] ~ '******' }}</li>
      <li class="list-group-item"><strong>Address:</strong> 
        {% if requirement.mode == 'offline' %}
          {{ requirement.address[:6] ~ '******' }}
        {% else %}
          N/A
        {% endif %}
      </li>
    </ul>
  </section>

  <section class="mb-4">
    <h4>Tuition Requirement Details</h4>
    <ul class="list-group">
      <li class="list-group-item"><strong>Subject:</strong> {{ requirement.subject }}</li>
      <li class="list-group-item"><strong>Class:</strong> {{ requirement.student_class }}</li>
      <li class="list-group-item"><strong>Mode:</strong> {{ requirement.mode|capitalize }}</li>
      <li class="list-group-item"><strong>Description:</strong> {{ requirement.description }}</li>
    </ul>
  </section>

  <section class="mb-4">
    <h4>Attached PDF</h4>
    <p>
      {% if requirement.pdf_data %}
        <a href="{{ url_for('requirement_pdf', req_id=requirement.id) }}" target="_blank">Download PDF</a>
      {% else %}
        No file attached
      {% endif %}
    </p>
  </section>

  <section class="text-center mb-4">
    <p>Please scan the QR code below using your preferred UPI app to make the payment.</p>
    <img src="{{ url_for('static', filename='upi_qr.png') }}" alt="UPI Payment QR Code" class="img-fluid mx-auto" style="max-width: 300px;"/>
  </section>

  <section class="mb-4">
    {% if requirement.payment_verified %}
      <p class="text-success text-center font-weight-bold">Payment Verified</p>
    {% elif requirement.receipt_data %}
      <p class="text-warning text-center font-weight-bold">Receipt Uploaded - Waiting for verification</p>
    {% else %}
      <form action="{{ url_for('tutor.upload_receipt', req_id=requirement.id) }}" method="POST" enctype="multipart/form-data" class="text-center">
        <div class="form-group">
          <label for="receipt">Upload Payment Receipt</label>
          <input type="file" class="form-control-file mx-auto" id="receipt" name="receipt" required>
        </div>
        <button type="submit" class="btn btn-primary">Upload Receipt</button>
      </form>
    {% endif %}
  </section>

  <p class="mt-3 text-center">
    After completing the payment, you will receive confirmation and access to contact the student.
  </p>

  <div class="text-center">
    <a href="{{ url_for('tutor.dashboard') }}" class="btn btn-secondary mt-4">Cancel and Return to Dashboard</a>
  </div>
</div>
{% endblock %}
