{% extends "base.html" %}

{% block content %}
<div class="container my-5">

  {% if tutor.role is not defined or tutor.role == 'tutor' %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="display-4 text-primary mb-0">Tutor Dashboard</h2>
    <a href="{{ url_for('tutor.logout') }}" class="btn btn-outline-danger btn-lg">Logout</a>
  </div>

  <!-- Profile Card -->
  <div class="card shadow-sm mb-4 border-info">
    <div class="card-header bg-info text-white d-flex align-items-center">
      <i class="fas fa-user-circle fa-2x mr-3" aria-hidden="true"></i>
      <h4 class="mb-0">Profile Information</h4>
    </div>
    <div class="card-body">
      <ul class="list-group list-group-flush" role="list">
        <li class="list-group-item"><strong>Name:</strong> {{ tutor.name }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ tutor.email }}</li>
        <li class="list-group-item"><strong>Mobile No:</strong> {{ tutor.phone }}</li>
        <li class="list-group-item"><strong>Subjects Taught:</strong> {{ form.subjects.data }}</li>
        <li class="list-group-item"><strong>Mode of Teaching:</strong> {{ form.mode.data|capitalize }}</li>
        <li class="list-group-item"><strong>Skill Level:</strong> {{ form.skill.data|capitalize }}</li>
        <li class="list-group-item"><strong>Teaching Methodology:</strong> {{ form.methodology.data }}</li>
      </ul>
    </div>
  </div>

  <!-- Update Profile Form Card -->
  <div class="card shadow-sm border-primary">
    <div class="card-header bg-primary text-white d-flex align-items-center">
      <i class="fas fa-edit fa-2x mr-3" aria-hidden="true"></i>
      <h4 class="mb-0">Update Profile</h4>
    </div>
    <div class="card-body">
      <form method="POST" novalidate>
        {{ form.hidden_tag() }}
        <div class="form-group">
          {{ form.subjects.label(class="font-weight-bold") }}
          {{ form.subjects(class="form-control form-control-lg", placeholder="E.g. Math, Physics, English") }}
        </div>
        <div class="form-group">
          {{ form.mode.label(class="font-weight-bold") }}
          {{ form.mode(class="form-control form-control-lg") }}
        </div>
        <div class="form-group">
          {{ form.skill.label(class="font-weight-bold") }}
          {{ form.skill(class="form-control form-control-lg") }}
        </div>
        <div class="form-group">
          {{ form.methodology.label(class="font-weight-bold") }}
          {{ form.methodology(class="form-control form-control-lg", rows="5", placeholder="Describe your teaching methodology (100-200 words)") }}
          <small class="form-text text-muted">
            Share your teaching approach and methodology.
          </small>
        </div>
        {{ form.submit(class="btn btn-primary btn-lg btn-block") }}
      </form>
    </div>
  </div>

  <!-- Tuition Requirement Payment Receipts -->
  <div class="card shadow-sm border-secondary">
    <div class="card-header bg-secondary text-white">
      <h4 class="mb-0">Tuition Requirements</h4>
    </div>
    <div class="card-body">
      {% for requirement in requirements %}
        <div class="mb-3 p-3 border rounded">
          <h5>Subject: {{ requirement.subject }}</h5>
          <p>Class: {{ requirement.student_class }}</p>
          <p>Mode: {{ requirement.mode }}</p>
          <p>Description: {{ requirement.description }}</p>

          {% if requirement.payment_verified %}
            <p class="text-success font-weight-bold">Payment Verified</p>
          {% elif requirement.receipt_data %}
            <p class="text-warning font-weight-bold">Receipt Uploaded - Waiting for verification</p>
          {% else %}
            <form action="{{ url_for('tutor.upload_receipt', req_id=requirement.id) }}" method="POST" enctype="multipart/form-data">
              <div class="form-group">
                <label for="receipt_{{ requirement.id }}">Upload Payment Receipt</label>
                <input type="file" class="form-control-file" id="receipt_{{ requirement.id }}" name="receipt" required>
              </div>
              <button type="submit" class="btn btn-primary btn-sm">Upload Receipt</button>
            </form>
          {% endif %}
        </div>
      {% else %}
        <p>No tuition requirements assigned.</p>
      {% endfor %}
    </div>
  </div>

  {% else %}
    <div class="alert alert-danger" role="alert">
      Access denied. This area is only accessible to tutors.
    </div>
  {% endif %}
</div>
{% endblock %}
