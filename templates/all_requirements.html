{% extends "base.html" %}
{% block title %}All Tuition Requirements{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="mb-4">All Tuition Requirements</h2>
  {% if requirements %}
  <div class="row">
    {% for req in requirements %}
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm border-success h-100" style="background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-dark">{{ req.student.name }}</h5>
          <p class="card-text text-dark">
            <strong>Subject: </strong> {{ req.subject }}<br>
            <strong>Class: </strong> {{ req.student_class }}<br>
            <strong>Mode: </strong> {{ req.mode|capitalize }}<br>
            <strong>Posted On: </strong> {{ req.created_at.strftime('%Y-%m-%d %H:%M') }}
          </p>
          <p class="card-text text-muted small" style="margin-top:auto;">
            <strong>Email: </strong> 
            {% if session.get('tutor_id') and (req.tutor_id == session.get('tutor_id') or can_view_unmasked(session.get('tutor_id'), req.student.id)) %}
              {{ req.student.email }}
            {% else %}
              {{ req.student.email[:2] ~ '***@***' }}
            {% endif %}
            <br>
            <strong>Mobile: </strong> 
            {% if session.get('tutor_id') and (req.tutor_id == session.get('tutor_id') or can_view_unmasked(session.get('tutor_id'), req.student.id)) %}
              {{ req.student.phone }}
            {% else %}
              {{ req.student.phone[:2] ~ '******' }}
            {% endif %}
            <br>
            <strong>Address: </strong> 
            {% if req.mode == 'offline' %}
              {% if session.get('tutor_id') and (req.tutor_id == session.get('tutor_id') or can_view_unmasked(session.get('tutor_id'), req.student.id)) %}
                {{ req.address }}
              {% else %}
                {{ req.address[:6] ~ '******' }}
              {% endif %}
            {% else %}
              N/A
            {% endif %}
          </p>
          {% if session.get('tutor_id') %}
          <a href="{{ url_for('payment', req_id=req.id) }}" class="btn btn-light mt-3">Contact Student</a>
          {% else %}
          <a href="{{ url_for('tutor.login') }}" class="btn btn-light mt-3">Contact Student</a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination block remains same -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {% if pagination.has_prev %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('all_requirements', page=pagination.prev_num) }}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}
      {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
          {% if p == pagination.page %}
          <li class="page-item active"><span class="page-link">{{ p }}</span></li>
          {% else %}
          <li class="page-item"><a class="page-link" href="{{ url_for('all_requirements', page=p) }}">{{ p }}</a></li>
          {% endif %}
        {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
        {% endif %}
      {% endfor %}
      {% if pagination.has_next %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('all_requirements', page=pagination.next_num) }}">Next</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
  {% else %}
  <div class="alert alert-info">No tuition requirements posted yet.</div>
  {% endif %}
</div>
{% endblock %}
